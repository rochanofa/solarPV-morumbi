<!doctype html>
<meta charset="utf-8"/>
<html lang="en">
<head>
   <link rel="stylesheet" href="http://158.194.94.29:8081/webgis/libs/v6.5.0/css/ol.css" type="text/css">
    <link rel="stylesheet" href="http://158.194.94.29:8081/webgis/libs/v6.5.0/examples/resources/layout.css" type="text/css">
	 <link rel="stylesheet" href="http://158.194.94.29:8081/webgis/libs/ol-layerswitcher-master/dist/ol-layerswitcher.css" />
		
	  <script src="http://158.194.94.29:8081/webgis/libs/v6.5.0/build/ol.js"></script>
	    <script src="http://158.194.94.29:8081/webgis/libs/ol-layerswitcher-master/dist/ol-layerswitcher.js"></script>
		 <script src="http://158.194.94.29:8081/webgis/libs/jquery.min.js"></script>
	 

	 <link rel="stylesheet" href="http://158.194.94.29:8081/webgis/libs/ol-ext-master/dist/ol-ext.css" />
	  <script type="text/javascript" src="https://viglino.github.io/ol-ext/dist/ol-ext.js"></script>
	  
		 <link rel="stylesheet" href="http://158.194.94.29:8081/webgis/libs/bootstrap.min.css">
		 <script type="text/javascript" src="http://158.194.94.29:8081/webgis/libs/bootstrap.min.js"></script>
		
	<link rel="stylesheet" href="http://158.194.94.29:8081/webgis/libs/jquery-ui-1.12.1/jquery-ui.css">
	  <script src="http://158.194.94.29:8081/webgis/libs/jquery-ui-1.12.1/external/jquery/jquery.js"></script>
  <script src="http://158.194.94.29:8081/webgis/libs/jquery-ui-1.12.1/jquery-ui.js"></script>
  
  
  
<style>
  html,body {
	  height: 100%;
	  padding: 0;
	  margin: 0;
	  font-weight: normal;
	 font-family: Verdana, Geneva, sans-serif;
	}
	 #title{
	   position: absolute;
	    top: 0%;
        left: 0%;
		width: 100%;
	   height: 5%;
	   background-color: #f1f3f4;
	   border: 1px solid darkgrey;	   
	  }
  #map{
	   position: absolute;
	   top: 5%;
	   bottom: 5%;
	   width: 80%;
	   left: 20%;
	   height: 95%;
	   overflow: scroll;
	   border: 0.5px solid grey;
	  }
	  
	  #wms_layers_btn{
		position: absolute;
		z-index:500;
		top: 0.75%;
		left: 82%;
		font-family: Verdana, Geneva, sans-serif;
		font-size: 70%;
        }
				#data{
          width: 60%; 
        }
		 #table_data{
	        position: absolute;
			bottom: 0%;
			overflow: scroll;
            left: 20%;
			right: 0px;
			height: 0%;
			border: 1px solid #4CAF50;
	  }
		#table{
	    white-space:nowrap;
		grid-template-areas:"head-fixed" "body-scrollable";
                 }
		#showData{
		overflow: auto;
          width: 100%;
                }


		#table th {
		  position: -webkit-sticky; /* for Safari */
		  position: sticky;
		  top: 0;
		  background-color: LightCyan;
		}
		
		#table_wms_layers {
      width: 100%;
	  height: 250px;
      white-space:nowrap;
	  border-collapse: separate;
	  font-family: Verdana, Geneva, sans-serif;
		font-size:14px;
        }
	#table_wms_layers th {
	  position: -webkit-sticky; /* for Safari */
	  position: sticky;
	  top: 0;
	  background-color: LightCyan;
	}
	#clear_btn{
	  position: absolute;
	  z-index:500;
	  top: 0.75%;
	  left: 91%;
	  font-family: Verdana, Geneva, sans-serif;
	  font-size: 70%;
	}
	#download_link{
	  position: absolute;
	  z-index:500;
	  top: 0.75%;
	  left: 75%;
	  font-family: Verdana, Geneva, sans-serif;
	  font-size: 70%;
	}

		   
	  .ol-mouse-position{
	 top:96%;
	 right:35%;
	 position:absolute;
	 font-weight: normal;
	 font-size: 70%;
	 background-color: #02182d;
	 opacity: 0.8;
	 color: white;
	 }
     .layer-switcher.shown {
      max-height: 200px;
	  font-size: 70%;
     }
	  #query_tab{
	 position: absolute;
	 //padding: 0.5% 0%;
        top: 5%;
		height: 60%;
        overflow: scroll;
        width:20%; 
        left:0%;
		font-size: 80%;
	 }
     
    .tab-content {
	 position: relative;
	 top:1%;
	 padding-left: 4px;
     width:80%;
	 height:85%;
	font-size: 100%;
	       }

	 .ol-scale-line{
	 top:99%;
	 right:50%;
	 left: auto;
	 position:absolute;
	 background-color: #02182d;
	 opacity: 0.8;
	 }
	 .ol-scale-line-inner {
		margin: 1px;	
		border-top: none;
		font-size: 8px;
	 }
	 .ol-search ul {
			color: #333;
			font-size:0.85em;
			max-width: 21em;
			left:0%;
		}
		.ol-search ul i {
			display: block;
			color: #333;
			font-size:0.85em;
						left:0%;
		}
		.info {
			display: inline-block;
			width: 100%;
		}
		.info a img {
			height: 100px;
			margin-right: .5em;
			float: left;
		}
	 
	 #legend{
	    z-index: 11;
		padding: 2px 4px;
		border: 1px solid grey;
	    position: absolute;
		bottom: 0%;
		height: 35%;
        overflow: scroll;
        width:20%; 
        left: 0%;
		background-color: #ffffff;
		font-weight: normal;
		font-size: 90%;
		font-family: Verdana, Geneva, sans-serif;
	  }
	   .ol-popup {
        position: absolute;
        background-color: white;
        -webkit-filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));
        filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));
        padding: 7px;
        border-radius: 10px;
        border: 1px solid #cccccc;
        bottom: 5px;
        left: -50px;
        min-width: 280px;
      }
      .ol-popup:after, .ol-popup:before {
        top: 100%;
        border: solid transparent;
        content: " ";
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
      }
      .ol-popup:after {
        border-top-color: white;
        border-width: 10px;
        left: 48px;
        margin-left: -10px;
      }
      .ol-popup:before {
        border-top-color: #cccccc;
        border-width: 11px;
        left: 48px;
        margin-left: -11px;
      }
      .ol-popup-closer {
        text-decoration: none;
        position: absolute;
        top: 2px;
        right: 8px;
      }
      .ol-popup-closer:after {
        content: "X";
      }
	  #measuretype{
	  color: black;}
	  
	  #getinfotype{
	   color: black;}
	  
	  #measure {
		 position: absolute;
      z-index:50;
	  top: 5px;
	  height:10px;
	  left: 29%;
	  color: white;
	  text-shadow: 0 0 2px black;
	  font-family: Verdana, Geneva, sans-serif;
	  font-size:80%;
	  }
	   #getinfo{
		position: absolute;
      z-index:50;
	  top: 5px;
	  height:10px;
	  left: 55%;
     color: white;
	  text-shadow: 0 0 2px black;
	  font-family: Verdana, Geneva, sans-serif;
	  font-size:80%;
        }
	  .tooltip {
        position: relative;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 4px;
        color: white;
        padding: 4px 8px;
        opacity: 0.7;
        white-space: nowrap;
      }
      .tooltip-measure {
        opacity: 1;
        font-weight: bold;
      }
      .tooltip-static {
        background-color: #ffcc33;
        color: black;
        border: 1px solid white;
      }
      .tooltip-measure:before,
      .tooltip-static:before {
        border-top: 6px solid rgba(0, 0, 0, 0.5);
        border-right: 6px solid transparent;
        border-left: 6px solid transparent;
        content: "";
        position: absolute;
        bottom: -6px;
        margin-left: -7px;
        left: 50%;
      }
      .tooltip-static:before {
        border-top-color: #ffcc33;
      }    
	  
</style>

	 <style>
	button.btn-settings {
  margin: 25px;
  padding: 20px 30px;
  font-size: 1.2em;
  background-color: #337ab7;
  color: white;
	}
	button.btn-settings:active {
  color: white;
	}
	.modal {
    overflow: hidden;
	}
	.modal-dialog {    
	height:300px;
	}
	.modal-header {
	height:30px;
	  padding: 20px;
	  background-color:#18456b;
	  color:white;
	}
	.modal-title {
	  margin-top:-10px;
	  font-size:16px;
	}
	.modal-header .close {
	  margin-top:-10px;
	  color:#fff;
	}
	.modal-body {
	  color:#888;
	  padding: 5px 35px 20px;
	}
	.modal-body h3 {
	  text-align: center;
	}
	.modal-body p {
	  padding-top:10px;
	  font-size: 1.1em;
	}
</style>

  <title>Solar PV map Morumbi</title>
</head>
  <body>
  <div id="title"> <marquee behavior="scroll" direction="right"><h5><b>ðŸŒž Solar PV Potential Map of Morumbi,SÃ£o Paulo ðŸŒž</b></h5></marquee></div>
	 <div id="map"> 
		<form id="measure">
      <label>Measure &nbsp;</label>
      <select id="measuretype">
	    <option value="select">Select Measurement</option>
        <option value="length">Length (LineString)</option>
        <option value="area">Area (Polygon)</option>
		<option value="clear">Clear Measurement</option>
      </select>
	    </form>
	<form id="getinfo">
      <label>Layer info&nbsp;</label>
      <select id="getinfotype">
	  <option value="select">Select popup</option>
	    <option value="activate_getinfo">Activate Popup</option>
        <option value="deactivate_getinfo">Deactivate Popup</option>
        </select>
    </form>
	<button onclick="wms_layers()" id = "wms_layers_btn">WMS Layers</button>
	<button onclick="clear_all()" id = "clear_btn">Clear</button>
	<button onclick="location.href='https://github.com/rochanofa/solarPV-morumbi'" id = "download_link">Github repo</button>
	</div>
	 
	 <div id="popup" class="ol-popup">
      <a href="#" id="popup-closer" class="ol-popup-closer"></a>
      <div id="popup-content"></div>
	 </div>
	 <div id="info">&nbsp;</div>

	<div id="legend"></div>
	<div id="query_tab">
	<ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#form">Query tool</a></li>
	<li><a data-toggle="tab" href="#form1">Select by Draw</a></li>
        
	</ul>
	
	<div class="tab-content">
	<div id="form" class="tab-pane fade in active">
	<label for="layer">Select Layer</label>
	<select class="form-control" id="layer" name="layer">
	<option value="">Select Layer</option>
	</select>
	<br>
	<label for="attributes">Select attribute</label>
	<select class="form-control" id="attributes" name="attributes">
	<option value="">Select Attributes</option>
	</select>
	<br>
	<label for="operator">Select operator</label>
	<select class="form-control" id="operator" name="operator">
	<option value="">Select operator</option>
	</select>
	<br>

	<label for="value">Enter Value</label>
	<input type="text" class="form-control" id="value" name="value">
	<br>
	<button class="btn btn-success" onclick="query()">Load Query</button>
	</div>
	
	<div id="form1" class="tab-pane fade">
	<label for="layer1">Select Layer</label>
	<select class="form-control" id="layer1" name="layer1">
	<option value="">Select Layer</option>
	</select>
	<br>
	

	<label for="draw_type">Geometry type &nbsp;</label>
      <select class="form-control" id="draw_type" name ="draw_type">
	   <option value="select">Select Shape</option>
      <option value="Square">Square</option>
        <option value="Box">Box</option>
        <option value="Polygon">Polygon</option>
		<option value="Star">Star</option>
		<option value="clear">Clear</option>
      </select>
<br>

</div>
</div>
</div>
	
	<div id = "table_data"> </div>
	<div id="wms_layers_window" title="Available WMS Layers" style="display:none"></div>
	<table id="table_wms_layers" class = "table-bordered">
    </table>
	 	 
    <script type="text/javascript">
	var map, geojson, layer_name, layerSwitcher, featureOverlay; 
    var container, content, closer;
	
	var container = document.getElementById('popup');
    var content = document.getElementById('popup-content');
    var closer = document.getElementById('popup-closer');
	
	  /**
       * Create an overlay to anchor the popup to the map.
       */
      var overlay = new ol.Overlay({
        element: container,
        autoPan: true,
        autoPanAnimation: {
          duration: 250
        }
      });


      /**
       * Add a click handler to hide the popup.
       * @return {boolean} Don't follow the href.
       */
      closer.onclick = function() {
        overlay.setPosition(undefined);
        closer.blur();
        return false;
      };
	  
	 //**************************************************************MAP BODY****************************************************/
	var view = new ol.View({
	projection: 'EPSG:4326',
         center: [-46.7067,-23.5963],
          zoom: 14,
		  
        });
		var view_ov = new ol.View({
		projection: 'EPSG:4326',
        center: [-46.70,-23.59],
          zoom: 14,
        });
		
		var base_maps = new ol.layer.Group({
                'title': 'Base maps',
				fold: 'open',
                layers: [
                        new ol.layer.Image({
                        title: 'Orthophoto 2017',
                        type: 'base',
                        visible: false,
                        source: new ol.source.ImageWMS({
							url: 'http://raster.geosampa.prefeitura.sp.gov.br/geoserver/geoportal/wms?',
							attributions: 'Â© <a href="http://geosampa.prefeitura.sp.gov.br/PaginasPublicas/_SBC.aspx#">GeoSampa Mapa - Prefeitura de SÃ£o Paulo</a>',
							params: {'LAYERS': 'Orto_PMD_RGB_2017'},
						})
                    }),
					new ol.layer.Tile({
                        title: 'Aerial with label',
                        type: 'base',
                        visible: false,
                        source: new ol.source.BingMaps({
							key:'AqYgXPRcagCsd0jNc1ejGQ8ToWXQ1ZWmqce0btpumxjcVOl9V6fZqNT2vwrxRKPC',
							imagerySet:'AerialWithLabels',
						})
                    }),
					new ol.layer.Tile({
                        title: 'Light mode',
                        type: 'base',
                        visible: false,
                        source: new ol.source.BingMaps({
							key:'AqYgXPRcagCsd0jNc1ejGQ8ToWXQ1ZWmqce0btpumxjcVOl9V6fZqNT2vwrxRKPC',
							imagerySet:'CanvasGray',
						})
                    }),
					new ol.layer.Tile({
                        title: 'Dark mode',
                        type: 'base',
                        visible: true,
                        source: new ol.source.BingMaps({
							key:'AqYgXPRcagCsd0jNc1ejGQ8ToWXQ1ZWmqce0btpumxjcVOl9V6fZqNT2vwrxRKPC',
							imagerySet:'CanvasDark',
						})
                    }),
					new ol.layer.Tile({
                        title: 'OSM',
                        type: 'base',
                        visible: false,
                        source: new ol.source.OSM()
                    })
                ]
            });
		   
		var OSM = new ol.layer.Tile({
            source: new ol.source.OSM(),
			type: 'base',
			title: 'OSM',
          });
		  
		  var overlays = new ol.layer.Group({
                'title': 'Layer selection',
                layers: [
				new ol.layer.Image({
					title: 'Annual_solar_PV_potential_MWh',
				  source: new ol.source.ImageWMS({
					url: 'http://158.194.94.29:8081/geoserver/solar_pot/wms',
					params: {'LAYERS': 'solar_pot:Annual_solar_PV_potential_MWh'},
					ratio: 1,
					serverType: 'geoserver'
					})
				}),
				new ol.layer.Image({
				 title: 'Annual_solar_radiation_kWh_m2',
					source: new ol.source.ImageWMS({
					url: 'http://158.194.94.29:8081/geoserver/solar_pot/wms',
					params: {'LAYERS': 'solar_pot:Annual_solar_radiation_kWh_m2'},
					ratio: 1,
					serverType: 'geoserver'
				  })
				})
				]
			});
		 
	  
      var map = new ol.Map({
        target: 'map',
	    view: view,
		overlays: [overlay]
	      });	  
	 var scale = new ol.control.CanvasScaleLine({
		units: 'metric',
		});
		map.addControl (scale);

	  map.addLayer(base_maps);
	  map.addLayer(overlays);
	   
	  var unsuitable = new ol.layer.Image({
		  title: 'Unsuitable_building_for_PV',
         // extent: [-180, -90, -180, 90],
          source: new ol.source.ImageWMS({
            url: 'http://158.194.94.29:8081/geoserver/solar_pot/wms',
            params: {'LAYERS': 'solar_pot:Unsuitable_building_for_PV'},
            ratio: 1,
			attributions: '<img src=element/>',
            serverType: 'geoserver'
          })
        });
		
		overlays.getLayers().push(unsuitable);
//******************TOGGLE CONTROL*******************************************/	  
	var mouse_position = new ol.control.MousePosition(
	{coordinateFormat: ol.coordinate.createStringXY(4)
	});
	map.addControl(mouse_position);
	//overview
   var overview = new ol.control.OverviewMap({
	view: view_ov, 
	collapseLabel:'O', 
	label: 'O',
	layers:[OSM]
	});
	map.addControl(overview);
	//toggle fullscreen
	var full_sc = new ol.control.FullScreen({label:'F'});
	map.addControl(full_sc);
	//toggle zoomin+out
	var zoom = new ol.control.Zoom({zoomInLabel:'+', zoomOutLabel:'-'});
	map.addControl(zoom);
	//slider zoom
	var slider = new ol.control.ZoomSlider();
	map.addControl(slider);
	//zoom extent
	var zoom_ex = new ol.control.ZoomToExtent({
	extent:[
              -46.7627,-23.5673,
               -46.6403,-23.6220
            ]
			});
	map.addControl(zoom_ex);
	
	//********************************Geocoding control************************************************/
		//selection option
	var sLayer = new ol.layer.Vector({
		source: new ol.source.Vector(),
		style: new ol.style.Style({
			image: new ol.style.Circle({
				radius: 5,
				stroke: new ol.style.Stroke ({
					color: 'rgb(255,165,0)',
					width: 3
				}),
				fill: new ol.style.Fill({
					color: 'rgba(255,165,0,.3)'
				})
			}),
			stroke: new ol.style.Stroke ({
				color: 'rgb(255,165,0)',
				width: 3
			}),
			fill: new ol.style.Fill({
				color: 'rgba(255,165,0,.3)'
			})
		})
	});
	//map.addLayer(sLayer);
	//search controller, select object
	var search = new ol.control.SearchNominatim (
		{	reverse: true,
			position: true	// Search, with priority to geo position
		});
	map.addControl (search);
	
	// Select feature when click on the reference index
	search.on('select', function(e)
		{	// console.log(e);
			sLayer.getSource().clear();
			// Check if we get a geojson to describe the search
			if (e.search.geojson) {
				var format = new ol.format.GeoJSON();
				var f = format.readFeature(e.search.geojson, { dataProjection: "EPSG:4326", featureProjection: map.getView().getProjection() });
				sLayer.getSource().addFeature(f);
				var sview = map.getView();
				var resolution = view.getResolutionForExtent(f.getGeometry().getExtent(), map.getSize());
				var szoom = view.getZoomForResolution(resolution);
				var center = ol.extent.getCenter(f.getGeometry().getExtent());
				// redraw before zoom
				setTimeout(function(){
						sview.animate({
						center: center,
						zoom: Math.min (zoom, 16)
					});
				}, 100);
			}
			else {
				map.getView().animate({
					center:e.coordinate,
					zoom: Math.max (map.getView().getZoom(),16)
				});
			}
		});
		
	
	//**********************************************layer switcher*********************************/
	var layerSwitcher = new ol.control.LayerSwitcher({
    activationMode: 'click',
    startActive: true,
	tipLabel: 'Layers', // Optional label for button
    groupSelectStyle: 'children', // Can be 'children' [default], 'group' or 'none'
    collapseTipLabel: 'Collapse layers',
	});
	map.addControl(layerSwitcher);
  
  //***************************************Legend**************************************************/
  	function legend () {
		
		$('#legend').empty();
		
		var no_layers = overlays.getLayers().get('length');
	
		var head = document.createElement("p");
		
        var txt = document.createTextNode("Legend");
		
       head.appendChild(txt);
	   var element = document.getElementById("legend");
       element.appendChild(head);
		var ar = [];
		var i;
		for (i = 0; i < no_layers; i++) {
		ar.push("http://158.194.94.29:8081/geoserver/solar_pot/ows?service=WMS&request=GetLegendGraphic&format=image%2Fpng&WIDTH=15&HEIGHT=10&legend_options=fontName:Verdana;fontSize:5;fontAntiAliasing:false;dy:0.2;dpi:200;wrap:true&layer="+overlays.getLayers().item(i).get('title'));
		//alert(overlays.getLayers().item(i).get('title'));
		}
		for (i = 0; i < no_layers; i++) {
		var head = document.createElement("h6");
		
        var txt = document.createTextNode(overlays.getLayers().item(i).get('title'));
		//alert(txt[i]);
		head.appendChild(txt);
		var element = document.getElementById("legend");
		element.appendChild(head);
		var img = new Image();
		img.src = ar[i];
      
		var src = document.getElementById("legend");
		src.appendChild(img);
 
     }
	 
	 }
	 
	 legend();
	//*********************************************Getinfo popup********************************/
	function getinfo(evt) {
	
	var coordinate = evt.coordinate;
	        var viewResolution = /** @type {number} */ (view.getResolution());

	//alert(coordinate1);
	 $("#popup-content").empty();

	document.getElementById('info').innerHTML = '';
	var no_layers = overlays.getLayers().get('length');
	// alert(no_layers);
	var url = new Array();
	var wmsSource = new Array();
	var layer_title = new Array();
	
	
	var i;
	for (i = 0; i < no_layers; i++) {
	//alert(overlays.getLayers().item(i).getVisible());
	var visibility = overlays.getLayers().item(i).getVisible();
	//alert(visibility);
	if (visibility == true){
	 //alert(i);
	layer_title[i] = overlays.getLayers().item(i).get('title');
	// alert(layer_title[i]);
	wmsSource[i] = new ol.source.ImageWMS({
        url: 'http://158.194.94.29:8081/geoserver/solar_pot/wms',
        params: {'LAYERS': layer_title[i]},
        serverType: 'geoserver',
        crossOrigin: 'anonymous'
      });
	  //alert(wmsSource[i]);
	  //var coordinate2 = evt.coordinate;
		 // alert(coordinate);
         url[i] = wmsSource[i].getFeatureInfoUrl(
          evt.coordinate, viewResolution, 'EPSG:4326',
          {'INFO_FORMAT': 'text/html'});
		//  alert(url[i]);

        			 //assuming you use jquery
        $.get(url[i], function (data) {
		//alert(i);
            //append the returned html data
           
			
			// $("#info").html(data);
			 //document.getElementById('info').innerHTML = data;
			//document.getElementById('popup-content').innerHTML = '<p>Feature Info</p><code>' + data + '</code>';
			
			//alert(dat[i]);
			 $("#popup-content").append(data);
			//document.getElementById('popup-content').innerHTML = '<p>Feature Info</p><code>' + data + '</code>';

        overlay.setPosition(coordinate);
		
		layerSwitcher.renderPanel();
		
        });
		//alert(layer_title[i]);
		//alert(fid1[0]);
		
		
		 
			}
	 }
	
       
      }


		//map.on('singleclick', getinfo);
	   // map.un('singleclick', getinfo);
		
		getinfotype.onchange = function() {
		map.removeInteraction(draw);
		if (vectorLayer) {vectorLayer.getSource().clear();}
		map.removeOverlay(helpTooltip);
				if (measureTooltipElement) {
			 var elem = document.getElementsByClassName("tooltip tooltip-static");
			   
			for(var i = elem.length-1; i >=0; i--)
			   {

		elem[i].remove();
		//alert(elem[i].innerHTML);
			   }     
				}
		
		if (getinfotype.value == 'activate_getinfo'){
	   map.on('singleclick', getinfo);
	  }
	  else if (getinfotype.value == 'select' || getinfotype.value == 'deactivate_getinfo') {
	  map.un('singleclick', getinfo);
		overlay.setPosition(undefined);
        closer.blur();
	  }
      };
	  
	 //*******************************measurement tool************************************************************************/
	 var source = new ol.source.Vector();
	 var vectorLayer = new ol.layer.Vector({
	//title: 'layer',
		source: source,
		style: new ol.style.Style({
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 255, 0.2)'
          }),
          stroke: new ol.style.Stroke({
            color: '#ffcc33',
            width: 2
          }),
          image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
              color: '#ffcc33'
            })
          })
        })
      });
	
	//overlays.getLayers().push(vectorLayer);
	//map.addLayer(vectorLayer);
	
	//layerSwitcher.renderPanel();
	
		
		/**
       * Currently drawn feature.
       * @type {module:ol/Feature~Feature}
       */
      var sketch;


      /**
       * The help tooltip element.
       * @type {Element}
       */
      var helpTooltipElement;


      /**
       * Overlay to show the help messages.
       * @type {module:ol/Overlay}
       */
      var helpTooltip;


      /**
       * The measure tooltip element.
       * @type {Element}
       */
      var measureTooltipElement;


      /**
       * Overlay to show the measurement.
       * @type {module:ol/Overlay}
       */
      var measureTooltip;


      /**
       * Message to show when the user is drawing a polygon.
       * @type {string}
       */
      var continuePolygonMsg = 'Click to continue drawing the polygon';


      /**
       * Message to show when the user is drawing a line.
       * @type {string}
       */
      var continueLineMsg = 'Click to continue drawing the line';


      /**
       * Handle pointer move.
       * @param {module:ol/MapBrowserEvent~MapBrowserEvent} evt The event.
       */
      var pointerMoveHandler = function(evt) {
        if (evt.dragging) {
          return;
        }
        /** @type {string} */
        var helpMsg = 'Click to start drawing';

        if (sketch) {
          var geom = (sketch.getGeometry());
          if (geom instanceof ol.geom.Polygon) {
		 
            helpMsg = continuePolygonMsg;
          } else if (geom instanceof ol.geom.LineString) {
            helpMsg = continueLineMsg;
          }
        }

        helpTooltipElement.innerHTML = helpMsg;
        helpTooltip.setPosition(evt.coordinate);

        helpTooltipElement.classList.remove('hidden');
      };
	  
	   map.on('pointermove', pointerMoveHandler);

      map.getViewport().addEventListener('mouseout', function() {
        helpTooltipElement.classList.add('hidden');
      });

      //var measuretype = document.getElementById('measuretype');

      var draw; // global so we can remove it later


      /**
       * Format length output.
       * @param {module:ol/geom/LineString~LineString} line The line.
       * @return {string} The formatted length.
       */
      var formatLength = function(line) {
	  var length = ol.sphere.getLength(line,{projection:'EPSG:4326'});
        //var length = getLength(line);
		//var length = line.getLength({projection:'EPSG:4326'});
		
        var output;
        if (length > 100) {
          output = (Math.round(length / 1000 * 100) / 100) +
              ' ' + 'km';
			  
        } else {
          output = (Math.round(length * 100) / 100) +
              ' ' + 'm';
			  
        }
        return output;
		
      };


      /**
       * Format area output.
       * @param {module:ol/geom/Polygon~Polygon} polygon The polygon.
       * @return {string}// Formatted area.
       */
      var formatArea = function(polygon) {
	 // var area = getArea(polygon);
	 var area = ol.sphere.getArea(polygon, {projection:'EPSG:4326'});
       // var area = polygon.getArea();
		//alert(area);
		var output;
        if (area > 10000) {
          output = (Math.round(area / 1000000 * 100) / 100) +
              ' ' + 'km<sup>2</sup>';
        } else {
          output = (Math.round(area * 100) / 100) +
              ' ' + 'm<sup>2</sup>';
        }
        return output;
      };

      function addInteraction() {

	 var type;
	 if (measuretype.value == 'area')
	 { type = 'Polygon'; }
	 else if (measuretype.value == 'length')
	 {type = 'LineString';}
	 //alert(type);
	 
        //var type = (measuretype.value == 'area' ? 'Polygon' : 'LineString');
        draw = new ol.interaction.Draw({
          source: source,
          type: type,
          style: new ol.style.Style({
            fill: new ol.style.Fill({
              color: 'rgba(255, 255, 255, 0.5)'
            }),
            stroke: new ol.style.Stroke({
              color: 'rgba(255, 0, 0, 0.7)',
              lineDash: [10, 10],
              width: 2
            }),
            image: new ol.style.Circle({
              radius: 5,
              stroke: new ol.style.Stroke({
                color: 'rgba(0, 0, 0, 0.7)'
              }),
              fill: new ol.style.Fill({
                color: 'rgba(255, 255, 255, 0.5)'
              })
            })
          })
        });
        
	if (measuretype.value == 'select' || measuretype.value == 'clear')
	{

	map.removeInteraction(draw);
	if (vectorLayer) {vectorLayer.getSource().clear();}
	map.removeOverlay(helpTooltip);

	if (measureTooltipElement) {
		 var elem = document.getElementsByClassName("tooltip tooltip-static");
	//$('#measure_tool').empty(); 

	//alert(elem.length);
	for(var i = elem.length-1; i >=0; i--)
	{

	elem[i].remove();
	//alert(elem[i].innerHTML);
	}     
			}

	//var elem1 = elem[0].innerHTML;
	//alert(elem1);

	}

	else if (measuretype.value == 'area' || measuretype.value == 'length')
	{

	map.addInteraction(draw);
        createMeasureTooltip();
        createHelpTooltip();

        var listener;
        draw.on('drawstart',
          function(evt) {
            // set sketch
			
		
			//vectorLayer.getSource().clear();
			
            sketch = evt.feature;

            /** @type {module:ol/coordinate~Coordinate|undefined} */
            var tooltipCoord = evt.coordinate;

            listener = sketch.getGeometry().on('change', function(evt) {
              var geom = evt.target;
			  
              var output;
              if (geom instanceof ol.geom.Polygon) {
			  
                output = formatArea(geom);
                tooltipCoord = geom.getInteriorPoint().getCoordinates();
				
              } else if (geom instanceof ol.geom.LineString) {
			  
                output = formatLength(geom);
                tooltipCoord = geom.getLastCoordinate();
              }
              measureTooltipElement.innerHTML = output;
              measureTooltip.setPosition(tooltipCoord);
            });
          }, this);

        draw.on('drawend',
          function() {
            measureTooltipElement.className = 'tooltip tooltip-static';
            measureTooltip.setOffset([0, -7]);
            // unset sketch
            sketch = null;
            // unset tooltip so that a new one can be created
            measureTooltipElement = null;
            createMeasureTooltip();
            ol.Observable.unByKey(listener);
          }, this);
		  
		  }
      }


      /**
       * Creates a new help tooltip
       */
      function createHelpTooltip() {
        if (helpTooltipElement) {
          helpTooltipElement.parentNode.removeChild(helpTooltipElement);
        }
        helpTooltipElement = document.createElement('div');
        helpTooltipElement.className = 'tooltip hidden';
        helpTooltip = new ol.Overlay({
          element: helpTooltipElement,
          offset: [15, 0],
          positioning: 'center-left'
        });
        map.addOverlay(helpTooltip);
      }


      /**
       * Creates a new measure tooltip
       */
      function createMeasureTooltip() {
        if (measureTooltipElement) {
          measureTooltipElement.parentNode.removeChild(measureTooltipElement);
        }
        measureTooltipElement = document.createElement('div');
        measureTooltipElement.className = 'tooltip tooltip-measure';
		 
        measureTooltip = new ol.Overlay({
          element: measureTooltipElement,
          offset: [0, -15],
          positioning: 'bottom-center'
        });
        map.addOverlay(measureTooltip);
		
      }


      /**
       * Let user change the geometry type.
       */
     measuretype.onchange = function() {
	   map.un('singleclick', getinfo);
	overlay.setPosition(undefined);
        closer.blur();
     map.removeInteraction(draw);
        addInteraction();
      };
	  
//*******************************************WMS layer window*************************/
	function wms_layers(){
	$(function() {
  
       $( "#wms_layers_window" ).dialog({
          height: 350,
		  width: 600,
          modal: true
        });
		$( "#wms_layers_window" ).show();
   
		});
 
    $(document).ready(function(){
           $.ajax({
               type: "GET",
               url: "http://158.194.94.29:8081/geoserver/solar_pot/wms?request=getCapabilities",
               dataType: "xml",
               success: function(xml){
			$('#table_wms_layers').empty();
                 console.log("here");
				$('<tr></tr>').html('<th>Name</th><th>Title</th>').appendTo('#table_wms_layers');
                   $(xml).find('Layer').find('Layer').each(function(){
                       var name = $(this).children('Name').text();
					 // alert(name);
					//var name1 = name.find('Name').text();
					//alert(name);
                       var title = $(this).children('Title').text();
					    var abst = $(this).children('Abstract').text();
					//   alert(abst);
					 

					//   alert('test');
					    $('<tr></tr>').html('<td>' +name+ '</td><td>' +title+ '</td><td>' +abst+ '</td>').appendTo('#table_wms_layers');
						
					  
                   });
				   addRowHandlers();
               }
           });
   });
	  
	  
	var divContainer = document.getElementById("wms_layers_window");
					   var table1 = document.getElementById("table_wms_layers");
        divContainer.innerHTML = "";
        divContainer.appendChild(table1);
		$( "#wms_layers_window" ).show();
		
		var add_map_btn = document.createElement("BUTTON");
        add_map_btn.setAttribute("id", "add_map_btn");
		add_map_btn.innerHTML = "Add Layer to Map";
		add_map_btn.setAttribute("onclick", "add_layer()");
		divContainer.appendChild(add_map_btn);
	

	function addRowHandlers() {
//alert('knd');
    var rows = document.getElementById("table_wms_layers").rows;
	var table = document.getElementById('table_wms_layers');
	var heads = table.getElementsByTagName('th');
	var col_no;
	for (var i = 0; i < heads.length; i++) {
        // Take each cell
        var head = heads[i];
		//alert(head.innerHTML);
		if (head.innerHTML == 'Name') 
		{
		col_no = i+1; 
		//alert(col_no);
		}

		}
    for (i = 0; i < rows.length; i++) {
	
        rows[i].onclick = function(){ return function(){
		
		$(function() {
        $("#table_wms_layers td").each(function() {
   	   $(this).parent("tr").css("background-color", "white");
       });
       });
              var cell = this.cells[col_no-1];
               layer_name = cell.innerHTML;
			  // alert(layer_name);
			   
			   	$(document).ready(function () {
    $("#table_wms_layers td:nth-child("+col_no+")").each(function () {
        if ($(this).text() == layer_name) {
            $(this).parent("tr").css("background-color", "grey");
			
			
			
        }
		});
	});

               //alert("id:" + id);
        };}(rows[i]);
    }
	 /*$("#add_map_btn").click(function () {
       // var value = $(".selected td:first").html();
       // value = value || "No row Selected";
        alert(layer_name);
    });*/
	}
	}
//*****************************************Add layer function**********************************/
	function add_layer()
            {
						//alert("jd"); 
						
			//alert(layer_name);
			//map.removeControl(layerSwitcher);

	var name = layer_name.split(":");
						
		var layer_wms = new ol.layer.Image({
		  title: name[1],
         // extent: [-180, -90, -180, 90],
          source: new ol.source.ImageWMS({
            url: 'http://158.194.94.29:8081/geoserver/solar_pot/wms',
            params: {'LAYERS': layer_name},
            ratio: 1,
            serverType: 'geoserver'
          })
        });
		overlays.getLayers().push(layer_wms);
			
		var url = 'http://158.194.94.29:8081/geoserver/solar_pot/wms?request=getCapabilities';
    var parser = new ol.format.WMSCapabilities();


    $.ajax(url).then(function (response) {
        //window.alert("word");
        var result = parser.read(response);
       // console.log(result);
       // window.alert(result);
        var Layers = result.Capability.Layer.Layer;
        var extent;
        for (var i = 0, len = Layers.length; i < len; i++) {

            var layerobj = Layers[i];
          //  window.alert(layerobj.Name);

            if (layerobj.Name == layer_name)
            {
                extent = layerobj.BoundingBox[0].extent;
				//alert(extent);
				 map.getView().fit(
				extent,
				{ duration: 1590, size: map.getSize() }
				);
            }
        }
    });
		layerSwitcher.renderPanel();
		//map.addControl(layerSwitcher);
		legend();
		//map.addLayer(layer_wms);
	}
	//*******************************************QUERY SELECTION********************************************/
	// layers_name
		 	$(document).ready(function(){
			$.ajax({
				type: "GET",
				url: "http://158.194.94.29:8081/geoserver/solar_pot/wfs?request=getCapabilities",
				dataType: "xml",
				success: function(xml) {
					var select = $('#layer');
					$(xml).find('FeatureType').each(function(){
						//var title = $(this).find('ows:Operation').attr('name');
						//alert(title);
						var name = $(this).find('Name').text();
						//select.append("<option/><option class='ddheader' value='"+ name +"'>"+title+"</option>");
							$(this).find('Name').each(function(){
							var value = $(this).text();
							select.append("<option class='ddindent' value='"+ value +"'>"+value+"</option>");
						});
					});
					//select.children(":first").text("please make a selection").attr("selected",true);
				}
			});
		});
		
		// attributes_dropdown

	$(function () {
	$("#layer" ).change(function () {
	
		var attributes = document.getElementById("attributes");
	var length = attributes.options.length;
	for (i = length-1; i >= 0; i--) {
	  attributes.options[i] = null;
	}
	
	  var value_layer = $(this).val();
	 
		
		attributes.options[0] = new Option('Select attributes', "");
		//  alert(url);
		
			$(document).ready(function(){
			$.ajax({
				type: "GET",
				url: "http://158.194.94.29:8081/geoserver/solar_pot/wfs?service=WFS&request=DescribeFeatureType&version=1.1.0&typeName="+value_layer,
				dataType: "xml",
				success: function(xml) {
				
				var select = $('#attributes');
				//var title = $(xml).find('xsd\\:complexType').attr('name');
			//	alert(title);
				$(xml).find('xsd\\:sequence').each(function(){
				
				$(this).find('xsd\\:element').each(function(){
				var value = $(this).attr('name');
				//alert(value);
				var type = $(this).attr('type');
				//alert(type);
				if (value != 'geom' && value != 'the_geom') {
				select.append("<option class='ddindent' value='"+ type +"'>"+value+"</option>");
				}
				});
				
				});
				}
			});
		});
	
	
		});
		});
		
		
		// operator combo
$(function () {
	$("#attributes" ).change(function () {
	
		var operator = document.getElementById("operator");
var length = operator.options.length;
for (i = length-1; i >= 0; i--) {
  operator.options[i] = null;
}
	
	  var value_type = $(this).val();
	 // alert(value_type);
	  var value_attribute = $('#attributes option:selected').text();
operator.options[0] = new Option('Select operator', "");

	  if (value_type == 'xsd:short' || value_type == 'xsd:int' || value_type == 'xsd:double')
			{
			var operator1 = document.getElementById("operator");
			operator1.options[1] = new Option('Greater than', '>');
			operator1.options[2] = new Option('Less than', '<');
			operator1.options[3] = new Option('Equal to', '=');
			}
			else if (value_type == 'xsd:string')
			{
			var operator1 = document.getElementById("operator");
			operator1.options[1] = new Option('Like', 'ILike');
			
			}

});
});

	 var highlightStyle = new ol.style.Style({
  fill: new ol.style.Fill({
    color: 'rgba(255,255,255,0.7)',
  }),
  stroke: new ol.style.Stroke({
    color: '#3399CC',
    width: 3,
  }),
 image: new ol.style.Circle({
            radius: 10,
            fill: new ol.style.Fill({
              color: '#3399CC'
            })
          })
});

 featureOverlay = new ol.layer.Vector({
        source: new ol.source.Vector(),
        map: map,
		style: highlightStyle
      });
		//var highlight1;
		
	function findRowNumber(cn1, v1){
  var table = document.querySelector('#table');
  var rows = table.querySelectorAll("tr");
  var msg = "No such row exist"
  for(i=1;i<rows.length;i++){
    var tableData = rows[i].querySelectorAll("td");
    if(tableData[cn1-1].textContent==v1){
      msg = i;
      break;
    }
  }
  return msg;
}


function addRowHandlers() {
    var rows = document.getElementById("table").rows;
	var heads = table.getElementsByTagName('th');
	var col_no;
	for (var i = 0; i < heads.length; i++) {
        // Take each cell
        var head = heads[i];
		//alert(head.innerHTML);
		if (head.innerHTML == 'objectid') 
		{
		col_no = i+1; 
		//alert(col_no);
		}

		}
    for (i = 0; i < rows.length; i++) {
	
	 	
	
        rows[i].onclick = function(){ return function(){
		featureOverlay.getSource().clear();
		
		$(function() {
        $("#table td").each(function() {
   	   $(this).parent("tr").css("background-color", "white");
       });
       });
              var cell = this.cells[col_no-1];
               var id = cell.innerHTML;
			   
			   
			   	$(document).ready(function () {
    $("#table td:nth-child("+col_no+")").each(function () {
        if ($(this).text() == id) {
            $(this).parent("tr").css("background-color", "grey");
        }
    });
});

var features = geojson.getSource().getFeatures();
//alert(features.length);


for (i=0; i< features.length; i++)
{



if (features[i].get('objectid') == id)
{
featureOverlay.getSource().addFeature(features[i]);

		featureOverlay.getSource().on('addfeature', function(){
    map.getView().fit(
        featureOverlay.getSource().getExtent(),
        { duration: 1590, size: map.getSize() }
    );
 });
  
}
}

               //alert("id:" + id);
        };}(rows[i]);
    }
}


		
		function  highlight(evt) {
		featureOverlay.getSource().clear();
    var feature = map.forEachFeatureAtPixel(evt.pixel,
      function(feature, layer) {
        return feature;
      });
	  
    if (feature) {
	
        var geometry = feature.getGeometry();
        var coord = geometry.getCoordinates();
		var coordinate = evt.coordinate;
		   
	   $(function() {
        $("#table td").each(function() {
   	   $(this).parent("tr").css("background-color", "white");
       });
       });
		  
        featureOverlay.getSource().addFeature(feature);
    }
	


var table = document.getElementById('table');
    var cells = table.getElementsByTagName('td');
	var rows = document.getElementById("table").rows;
	var heads = table.getElementsByTagName('th');
	var col_no;
	for (var i = 0; i < heads.length; i++) {
        // Take each cell
        var head = heads[i];
		//alert(head.innerHTML);
		if (head.innerHTML == 'objectid') 
		{
		col_no = i+1; 
		//alert(col_no);
		}

		}
		var row_no = findRowNumber(col_no, feature.get('objectid'));
		//alert(row_no);
		
		var rows = document.querySelectorAll('#table tr');

rows[row_no].scrollIntoView({
    behavior: 'smooth',
    block: 'center'
});

			$(document).ready(function () {
    $("#table td:nth-child("+col_no+")").each(function () {
	
        if ($(this).text() == feature.get('objectid')) {
            $(this).parent("tr").css("background-color", "grey");
			
        }
    });
});




	};	
	
function query(){

$('#table').empty();
if(geojson)
		{
		map.removeLayer(geojson);
		
		}
		
		if(featureOverlay)
		{
		featureOverlay.getSource().clear();
		map.removeLayer(featureOverlay);
		
		}
	//alert('jsbchdb');	
var layer = document.getElementById("layer");
var value_layer = layer.options[layer.selectedIndex].value;
//alert(value_layer);

var attribute = document.getElementById("attributes");
var value_attribute = attribute.options[attribute.selectedIndex].text;
//alert(value_attribute);

var operator = document.getElementById("operator");
var value_operator = operator.options[operator.selectedIndex].value;
//alert(value_operator);

var txt = document.getElementById("value");
var value_txt = txt.value;

if (value_operator == 'ILike')
			{
			value_txt = ""+value_txt+"%25";
			//alert(value_txt);
			//value_attribute = 'strToLowerCase('+value_attribute+')';
			}
			else{
			value_txt = value_txt;
			//value_attribute = value_attribute;
			}
//alert(value_txt);


 var url = "http://158.194.94.29:8081/geoserver/solar_pot/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+value_layer+"&CQL_FILTER="+value_attribute+"+"+value_operator+"+'"+value_txt+"'&outputFormat=application/json"
//alert(url);

var style = new ol.style.Style({
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 255, 0.7)'
          }),
          stroke: new ol.style.Stroke({
            color: '#ffcc33',
            width: 3
          }),
		 /* image: new ol.style.Icon({
    anchor: [0.5, 46],
    anchorXUnits: 'fraction',
    anchorYUnits: 'pixels',
    src: 'img/marker.png',
  }),*/
          image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
              color: '#ffcc33'
            })
          })
        });
		
	

     geojson = new ol.layer.Vector({
      //title:'dfdfd',
	 //title: '<h5>' + value_crop+' '+ value_param +' '+ value_seas+' '+value_level+'</h5>',
          source: new ol.source.Vector({
		 url: url,
          format: new ol.format.GeoJSON()
          }),
		  style: style,
     
        });
		
		geojson.getSource().on('addfeature', function(){
		//alert(geojson.getSource().getExtent());
    map.getView().fit(
        geojson.getSource().getExtent(),
        { duration: 1590, size: map.getSize() }
    );
 });
 
 //overlays.getLayers().push(geojson);
		map.addLayer(geojson);
		
	
		$.getJSON(url, function(data) {
	 var col = [];
	 col.push('id');
        for (var i = 0; i < data.features.length; i++) {
		
            for (var key in data.features[i].properties) {
			
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }
		
		
	
	  var table = document.createElement("table");
	  
	  
table.setAttribute("class", "table table-bordered");
table.setAttribute("id", "table");
        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

        var tr = table.insertRow(-1);                   // TABLE ROW.

        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        // ADD JSON DATA TO THE TABLE AS ROWS.
        for (var i = 0; i < data.features.length; i++) {

            tr = table.insertRow(-1);

            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
				if (j == 0) {tabCell.innerHTML = data.features[i]['id'];}
				else{
				//alert(data.features[i]['id']);
                tabCell.innerHTML = data.features[i].properties[col[j]];
				//alert(tabCell.innerHTML);
				}
            }
        }
		
		  

        // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        var divContainer = document.getElementById("table_data");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);
		addRowHandlers();
		
   document.getElementById('map').style.height='75%';
    document.getElementById('table_data').style.height='25%';
	map.updateSize();
});
	
	
	map.on('click', highlight);
	
addRowHandlers();

}

$(document).ready(function(){
			$.ajax({
				type: "GET",
				url: "http://158.194.94.29:8081/geoserver/solar_pot/wfs?request=getCapabilities",
				dataType: "xml",
				success: function(xml) {
					var select = $('#layer1');
					$(xml).find('FeatureType').each(function(){
						//var title = $(this).find('ows:Operation').attr('name');
						//alert(title);
						var name = $(this).find('Name').text();
						//select.append("<option/><option class='ddheader' value='"+ name +"'>"+title+"</option>");
							$(this).find('Name').each(function(){
							var value = $(this).text();
							select.append("<option class='ddindent' value='"+ value +"'>"+value+"</option>");
						});
					});
					//select.children(":first").text("please make a selection").attr("selected",true);
				}
			});
		});
		

		// draw shapes

 var source1 = new ol.source.Vector({wrapX: false});

      var vector1 = new ol.layer.Vector({
        source: source1
      });
	  //map.addLayer(vector1);
	  var draw_typeSelect = document.getElementById('draw_type');
	  
	  
      var draw1; // global so we can remove it later
      function add_draw_Interaction() {
        var value = draw_typeSelect.value;
		//alert(value);
        if (value !== 'None') {
          var geometryFunction;
		  if (value === 'Square') {
            value = 'Circle';
			geometryFunction = new ol.interaction.Draw.createRegularPolygon(4);
			
          } else if (value === 'Box') {
            value = 'Circle';
			
            geometryFunction = new ol.interaction.Draw.createBox();
			
          } else if (value === 'Star') {
            value = 'Circle';
            geometryFunction = function(coordinates, geometry) {
			//alert(value);
              var center = coordinates[0];
              var last = coordinates[1];
              var dx = center[0] - last[0];
              var dy = center[1] - last[1];
              var radius = Math.sqrt(dx * dx + dy * dy);
              var rotation = Math.atan2(dy, dx);
              var newCoordinates = [];
              var numPoints = 12;
              for (var i = 0; i < numPoints; ++i) {
                var angle = rotation + i * 2 * Math.PI / numPoints;
                var fraction = i % 2 === 0 ? 1 : 0.5;
                var offsetX = radius * fraction * Math.cos(angle);
                var offsetY = radius * fraction * Math.sin(angle);
                newCoordinates.push([center[0] + offsetX, center[1] + offsetY]);
              }
              newCoordinates.push(newCoordinates[0].slice());
              if (!geometry) {
                geometry = new ol.geom.Polygon([newCoordinates]);
              } else {
                geometry.setCoordinates([newCoordinates]);
              }
              return geometry;
            };
          }
         draw1 = new ol.interaction.Draw({
            source: source1,
            type: value,
            geometryFunction: geometryFunction
          });
         // map.addInteraction(draw1);
		 
		      if (draw_typeSelect.value == 'select' || draw_typeSelect.value == 'clear')
           {

				map.removeInteraction(draw1);
				vector1.getSource().clear();
				if (geojson) {geojson.getSource().clear(); map.removeLayer(geojson);}

			}
			else if ( draw_typeSelect.value == 'Square' || draw_typeSelect.value == 'Polygon' || draw_typeSelect.value == 'Circle' || draw_typeSelect.value == 'Star' || draw_typeSelect.value == 'Box' ) 

			{
			
			map.addInteraction(draw1);
			
			draw1.on('drawstart', function(evt){
			if (vector1) {vector1.getSource().clear();}
			if (geojson) {geojson.getSource().clear(); map.removeLayer(geojson);}
			
//alert('bc');
			
			});
			
			draw1.on('drawend', function(evt){
    var feature = evt.feature;
    var coords = feature.getGeometry();
	//alert(coords.toString());
	var format = new ol.format.WKT();
var wkt  = format.writeGeometry(coords);
//alert(wkt);
var layer_name = document.getElementById("layer1");
var value_layer = layer_name.options[layer_name.selectedIndex].value;

var url = "http://158.194.94.29:8081/geoserver/solar_pot/wfs?request=GetFeature&version=1.0.0&typeName="+value_layer+"&outputFormat=json&cql_filter=INTERSECTS(geom,"+wkt+")";
	//alert(url);
	/*var style = new ol.style.Style({
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 255, 0.7)'
          }),
          stroke: new ol.style.Stroke({
            color: '#ffcc33',
            width: 3
          }),
		  
          image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
              color: '#ffcc33'
            })
          })
        });*/
	
	var style = new ol.style.Style({
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 255, 0.7)'
          }),
          stroke: new ol.style.Stroke({
            color: '#ffcc33',
            width: 3
          }),
		  image: new ol.style.Icon({
    anchor: [0.5, 46],
    anchorXUnits: 'fraction',
    anchorYUnits: 'pixels',
    src: 'img/marker.png',
  }),
          /*image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
              color: '#ffcc33'
            })
          })*/
        });
		
		geojson = new ol.layer.Vector({
      
	 //title: '<h5>' + value_crop+' '+ value_param +' '+ value_seas+' '+value_level+'</h5>',
          source: new ol.source.Vector({
		 url: url,
		
          format: new ol.format.GeoJSON()
          }),
		  style: style,
     
        });
		
		geojson.getSource().on('addfeature', function(){
		//alert(geojson.getSource().getExtent());
    map.getView().fit(
        geojson.getSource().getExtent(),
        { duration: 1590, size: map.getSize() }
    );
 });
 
 //overlays.getLayers().push(geojson);
		map.addLayer(geojson);
		map.removeInteraction(draw1);
		$.getJSON(url, function(data) {
	//alert(data.features[0].properties);
	//alert(data.features.length);
	 var col = [];
	 col.push('id');
        for (var i = 0; i < data.features.length; i++) {
		
            for (var key in data.features[i].properties) {
			
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }
		
		
	
	  var table = document.createElement("table");
	  
	  
table.setAttribute("class", "table table-bordered");
table.setAttribute("id", "table");
        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.

        var tr = table.insertRow(-1);                   // TABLE ROW.

        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        // ADD JSON DATA TO THE TABLE AS ROWS.
        for (var i = 0; i < data.features.length; i++) {

            tr = table.insertRow(-1);

            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
				if (j == 0) {tabCell.innerHTML = data.features[i]['id'];}
				else{
				//alert(data.features[i]['id']);
                tabCell.innerHTML = data.features[i].properties[col[j]];
				//alert(tabCell.innerHTML);
				}
            }
        }
		
		  

        // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        var divContainer = document.getElementById("table_data");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);
		addRowHandlers();
		
   document.getElementById('map').style.height='71%';
    document.getElementById('table_data').style.height='25%';
	map.updateSize();
});

		
		map.on('click', highlight);

	addRowHandlers();

});



   

			}
					 
					 
					}
				  }


      /**
       * Handle change event.
       */
      draw_typeSelect.onchange = function() {
        map.removeInteraction(draw1);
	//	if (draw2) {map.removeInteraction(draw2)};
		if (draw) {map.removeInteraction(draw); map.removeOverlay(helpTooltip); map.removeOverlay(measureTooltip);}
	if (vectorLayer) {vectorLayer.getSource().clear();}
	if (vector1) {vector1.getSource().clear();}

if (measureTooltipElement) {
     var elem = document.getElementsByClassName("tooltip tooltip-static");
//$('#measure_tool').empty(); 

//alert(elem.length);
for(var i = elem.length-1; i >=0; i--)
{

elem[i].remove();
//alert(elem[i].innerHTML);
}     
        }
	
        add_draw_Interaction();
      };
	  
	function clear_all()
		{
		document.getElementById('map').style.height='100%';
    document.getElementById('table_data').style.height='0%';
	map.updateSize();
	$('#table').empty();
	//$('#table1').empty();
	if (geojson) {geojson.getSource().clear(); map.removeLayer(geojson);}
	if (featureOverlay) {featureOverlay.getSource().clear(); map.removeLayer(featureOverlay);}
		map.removeInteraction(draw);
if (vectorLayer) {vectorLayer.getSource().clear();}
map.removeOverlay(helpTooltip);
		if (measureTooltipElement) {
     var elem = document.getElementsByClassName("tooltip tooltip-static");
	   
    for(var i = elem.length-1; i >=0; i--)
       {

elem[i].remove();
//alert(elem[i].innerHTML);
       }     
        }
		map.un('singleclick', getinfo);
	overlay.setPosition(undefined);
        closer.blur();
		
map.un('click', highlight);

	
		}
		
    </script>
	
  </body>
</html>
